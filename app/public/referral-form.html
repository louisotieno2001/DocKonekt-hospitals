<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us</title>
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="styles/small-devices.css">
    <link rel="icon" href="./res/Picture4.png" type="image/x-icon">
</head>
<body>
    <div class="top_bar">
        <img src="./res/Picture4.png" alt="logo" class="logo">
        <ul class="menu-items" id="menu-items">
            <li><a href="index.html">Home</a></li>
            <li><a href="health_blog.html">Health Blog</a></li>
            <li><a href="get_in_touch.html">Contact Us</a></li>
            <li><a href="referral-form.html">Refer to another hospital</a></li>
        </ul>
        <img src="./res/menu_icon.png" alt="menu_icon" class="menu_icon" id="menu_icon">
        <div class="profile">
            <img src="./res/photo.avif" alt="Profile image">
        </div>
    </div>
    <div class="text-explain">
        <p>As you fill the referral form, be careful to fill in as accurate information as possible. All contacts should be instantly accessible as the referral is being processed</p>
    </div>
    <div class="form-div">
    <form action="" method="" class="form" id="form">
        <h1>Patient details</h1>
        <label for="patient-name">Patient name</label> <br>
        <input type="text" name="patient-name" id="patient-name" required placeholder="John Doe"><br>
        <label for="emergency-phone">Emmergency phone number</label><br>
        <input type="tel" name="emergency-phone" id="emergency-phone" required placeholder="Next of kin phone number"><br>
        <label for="urgency">Urgency of patient situation</label><br>
        <select name="urgency" id="urgency">
          <option value="Serious">Very Serious</option>
          <option value="medium">Medium serious</option>
          <option value="low">Not serious</option>
        </select>

        <h1>Doctor details</h1>
        <label for="hospital-name">Current hospital name</label><br>
        <input type="text" name="hospital-name" id="hospiital-name" required placeholder="Kenyatta Hospital"><br>
        <label for="doctor-name">Doctor's name</label> <br>
        <input type="text" name="doctor-name" id="doctor-name" required placeholder="Dr. John Doe"><br>
        <label for="doctors-phone">Doctor's contact</label><br>
        <input type="tel" name="emergency-phone" id="doctors-phone" required placeholder="0711223344"><br>
        <label for="message">Doctor's message</label><br>
        <textarea name="message" id="message" cols="30" rows="10" required
            placeholder="Write a brief  desciption of what condition the patient is in and what help they need..."></textarea>
            <button class="submit" type="submit" id="submit">Send</button>
    </form>
    </div>
    <div class="bottom_bar">
        <footer class="footer">
            <center><p>Follow us on social media below</p></center>
            <div class="socials">
                <li class="socials_lin"><a href="https://www.linkedin.com/company/futurionlabs/?viewAsMember=true" target="_blank"><img src="res/linkedin.png" alt="LinkedIn"></a></li>
                <li class="socials_fb"><a href="https://www.facebook.com/profile.php?id=61551541325742" target="_blank"><img src="res/Facebook.png" alt="Facebook"></a></li>
                <li class="socials_ig"><a href="https://www.instagram.com/futurion_labs123/" target="_blank"><img src="res/Instagram.png" alt="Instagram"></a></li>
                <li class="socials_wa"><a href="https://wa.me/254746852485" target="_blank"><img src="res/icon-whatsapp.webp" alt="Whatsapp"></a></li>
                <li class="socials_tw"><a href="https://twitter.com/louiso_chieng1" target="_blank"><img src="res/x.jpg" alt="twitter"></a></li>
            </div>
            <p>Copyright&copy;2024 Made at Futurion Labs (futurionlab.com). All rights reserved</p>
        </footer> 
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const menuIcon = document.getElementById('menu_icon');
                const menuItems = document.getElementById('menu-items');
        
                menuIcon.addEventListener('click', function () {
                menuItems.classList.toggle('show');
                });

                //Form validation for connection requests
                const mtForm = document.getElementById('form');
                const uname = document.getElementById("name");
                const email = document.getElementById("email");
                const phone = document.getElementById("phone");
                const message = document.getElementById("message");
                const submit = document.getElementById("submit");
                
                submit.addEventListener("click", async (e) => {
                  e.preventDefault();
                
                  //Get the values from the input fields
                  const unameValue = uname.value.trim();
                  const emailValue = email.value.trim();
                  const phoneValue = phone.value.trim();
                  const messageValue = message.value.trim();
                
                  // Check if any of the fields is empty
                  if (unameValue === "" && emailValue === "" && phoneValue === "" && messageValue === "") {
                    alert("Please fill all input fields");
                  }
                  else {
                    let data = {
                      name: unameValue,
                      email: emailValue,
                      phone: phoneValue,
                      message: messageValue,
                    }
                
                    try {
                      
                    
                    const res = await fetch('/api/messages', {
                      method: "POST",
                      headers: {
                        'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(data)
                    });
                    const json = await res.json();

                    // console.log(res);
                
                    if(res.ok){
                      // Reset the form after successful submission
                      uname.value = "";
                      email.value = "";
                      phone.value = "";
                      message.value = "";
                
                      window.confirm("Your message is sucessfully sent");
                      mtForm.style.display = 'none';
                      playFireworks();
                    }
                    else{
                       console.log("Something went wrong");
                    }
                
                  } catch (error) {
                    console.error("Error during sending of message:", error); 
                  }
                    
                  }
                });

                function fireworks() {
                  const canvas = document.getElementById('fireworksCanvas');
                  const ctx = canvas.getContext('2d');
                
                  canvas.width = window.innerWidth;
                  canvas.height = window.innerHeight;
                
                  const fireworksArray = [];
                
                  function createFirework() {
                      const firework = {
                          x: Math.random() * canvas.width,
                          y: canvas.height,
                          color: `rgb(${Math.random() * 255},${Math.random() * 255},${Math.random() * 255})`,
                          radius: 2,
                          speed: Math.random() * 20 + 10, // Adjusted for faster speed
                          angle: Math.random() * Math.PI * 2,
                          life: true,
                      };
                
                      fireworksArray.push(firework);
                  }
                
                  function drawFirework(firework) {
                      ctx.beginPath();
                      ctx.arc(firework.x, firework.y, firework.radius, 0, Math.PI * 2);
                      ctx.fillStyle = firework.color;
                      ctx.fill();
                  }
                
                  function updateFireworks() {
                      fireworksArray.forEach((firework, index) => {
                          if (firework.life) {
                              firework.x += Math.cos(firework.angle) * firework.speed;
                              firework.y += Math.sin(firework.angle) * firework.speed;
                              firework.radius *= 1.03; // Adjusted for a faster growth rate
                
                              drawFirework(firework);
                
                              if (firework.y < 0 || firework.x < 0 || firework.x > canvas.width || firework.radius > 15) {
                                  fireworksArray.splice(index, 1);
                              }
                          }
                      });
                  }
                
                  function animate() {
                      ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                      if (Math.random() < 0.08) { // Adjusted for more frequent fireworks
                          createFirework();
                      }
                
                      updateFireworks();
                
                      requestAnimationFrame(animate);
                  }
                
                  animate();
                }
                
                // Call this function after a successful form submission
                function playFireworks() {
                  fireworks();
                } 
            });
        </script>
    </div>
</body>
</html>